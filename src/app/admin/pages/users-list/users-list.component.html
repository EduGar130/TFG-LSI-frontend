<div class="container">
  <div class="p-inputgroup mb-3">
    <input type="text" pInputText [(ngModel)]="filtro" (input)="aplicarFiltro()" placeholder="Buscar usuario..." />
    <button pButton icon="pi pi-times" class="p-button-secondary" (click)="limpiarFiltro()"></button>
  </div>

  <p-table
    *ngIf="!cargando"
    [value]="usuariosFiltrados"
    [paginator]="true"
    [rows]="10"
    [responsiveLayout]="'scroll'"
    [rowTrackBy]="trackById"
    [globalFilterFields]="['username','email','warehouse.name','role.name']"
    [filterDelay]="0"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} usuarios"
  >
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="username">Usuario <p-sortIcon field="username"></p-sortIcon></th>
        <th pSortableColumn="email">Email <p-sortIcon field="email"></p-sortIcon></th>
        <th pSortableColumn="warehouse.name">Almac√©n <p-sortIcon field="warehouse.name"></p-sortIcon></th>
        <th pSortableColumn="role.name">Rol <p-sortIcon field="role.name"></p-sortIcon></th>
        <th>Acciones</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-usuario>
      <tr>
        <td>{{ usuario.username }}</td>
        <td>{{ usuario.email }}</td>
        <td>{{ usuario.warehouse?.name || 'Global' }}</td>
        <td>{{ usuario.role?.name }}</td>
        <td>
          <!-- <button pButton icon="pi pi-search" class="p-button-rounded p-button-info p-button-sm" (click)="abrirDetalleUsuario(usuario)"></button> -->
          <button pButton icon="pi pi-user-edit" class="p-button-rounded p-button-warning p-button-sm ml-2" (click)="abrirEditarUsuario(usuario)"></button>
          <button pButton icon="pi pi-user-minus" class="p-button-rounded p-button-danger p-button-sm ml-2" (click)="confirmarEliminarUsuario(usuario)"></button>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <div class="mt-3 d-flex gap-2">
    <button class="button" pButton type="button" label="Crear Usuario" icon="pi pi-plus" (click)="abrirNuevoUsuario()"></button>
  </div>
</div>